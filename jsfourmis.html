<html>
 <head>
  <!-- Slider control (cf. LICENSE for opensource license) -->
  <link rel="stylesheet" type="text/css" href="slider/slider.css" />
  <script type="application/javascript" src="slider/slider.js"></script>
  
  <script type="application/javascript">
	var JSFOURMIS = {};	// namespace
	function bind(scope, fn) {
	    return function () {
	        fn.apply(scope, arguments);
	    };
	}
	function $totalOffset(e) {
		var curleft = 0, curtop = 0;
		if (e.offsetParent) {
			do {
				curleft += e.offsetLeft;
				curtop += e.offsetTop;
			} while (e = e.offsetParent);
			return {left:curleft, top:curtop};
		}
	}
  </script>
  <script type="application/javascript" src="Parametres.js"></script>
  <script type="application/javascript" src="Constantes.js"></script>
  <script type="application/javascript" src="Matrice.js"></script>
  <script type="application/javascript" src="Fourmi.js"></script>
  <script type="application/javascript" src="Fleche.js"></script>
  <script type="application/javascript" src="Nourriture.js"></script>
  <script type="application/javascript" src="Pheromone.js"></script>  
  <script type="application/javascript" src="Obstacle.js"></script>  
  <script type="application/javascript" src="Kanvas.js"></script>
  <script type="application/javascript">
	var $ = function(e){ return document.getElementById(e); };
	var $$ = function (e) { return document.getElementsByClassName(e); };
	var k = new JSFOURMIS.Kanvas();
	var valeurConcrete = function (min, max, pourcentage) {
		return  pourcentage * (max - min)|0;
	};
	var onBodyLoad = function() {
		var paramTable = $('parametres');
		var doc = document;
		for(var param in JSFOURMIS.Parametres) 
		{
			if(JSFOURMIS.Parametres[param].parametrable) 
			{
				var tr = document.createElement('TR');
				var td = [null, null, null];
				td[0] = doc.createElement('TD');
				td[1] = doc.createElement('TD');
				td[2] = doc.createElement('TD');
				td[0].innerHTML = JSFOURMIS.Parametres[param].label;
				td[0].style.width = '175px';
				var inputId = 'valeur_' + param;
				var divSlider	= doc.createElement('DIV');
				var divHandler	= doc.createElement('DIV');
				divSlider.setAttribute('id', param);
				divSlider.setAttribute('class', 'slider');
				divHandler.setAttribute('class', 'handle');
				divSlider.appendChild(divHandler);
				td[1].appendChild(divSlider);
				
				td[2].setAttribute('class', 'valeur');
				var inputValeur = doc.createElement('INPUT');
				inputValeur.setAttribute('type', 'text');
				inputValeur.setAttribute('id', inputId);
				inputValeur.setAttribute('value', '');
				td[2].appendChild(inputValeur);
				
				tr.appendChild(td[0]);
				tr.appendChild(td[1]);
				tr.appendChild(td[2]);
				
				paramTable.appendChild(tr);
					 
				new Slider(param, {
					callback: function(value, opts) {
						$(opts.inputId).value = valeurConcrete(
								JSFOURMIS.Parametres[opts.param_name].min, 
								JSFOURMIS.Parametres[opts.param_name].max, 
								value);
						JSFOURMIS.Parametres[opts.param_name].valeur = valeurConcrete(
							JSFOURMIS.Parametres[opts.param_name].min, 
							JSFOURMIS.Parametres[opts.param_name].max, 
							value);
					},
					steps: JSFOURMIS.Parametres[param].steps,
					value: JSFOURMIS.Parametres[param].valeur,
					params: {
						'inputId' : inputId,
						'param_name': param  
					}
				});
				inputValeur.value = JSFOURMIS.Parametres[param].valeur;
			}
		}	
	};
  </script>
  <style type="text/css">
	td.orientation { text-align: center;}
	.fourmis { height: 500px;}
	.slider {
		width: 600px;
		font-family: Helvetica, Arial, sans-serif;
		font-size: 12px;
	}
	table#parametres {
		border: 1px solid #DDD;	
	}
  </style>
  <title>JsFourmis</title>
 </head>
 <body onload="onBodyLoad();">
	<center>
		<table summary="Boussole et Canvas">
			<tr>
				<td rowspan="4"><img src="ant_01.jpg" class="fourmis"/></td>
				<td></td>
				<td id='nord' class="orientation">Nord</td>
				<td></td>
				<td rowspan="4"><img src="ant_02.jpg" class="fourmis"/></td>
			</tr>
			<tr>
				<td id='est' class="orientation">Ouest</td>
				<td>
					<!-- ICI le CANVAS, ICI -->
					<canvas style="border: 1px solid gray; cursor: none;" id="canvas" width="300" height="300"></canvas>
				</td>
				<td id='ouest' class="orientation">Est</td>
			</tr>
			<tr>
				<td></td>
				<td id='sud' class="orientation">Sud</td>
				<td></td>
			</tr>
			<tr>
				<td></td>
				<td style="text-align: center;">					
					<button onclick="k.start();">START</button>
					<button onclick="k.stop();">STOP</button>
				</td>
				<td></td>
			</tr>
		</table>
		<input type="text" id="log" value="" style="width: 300px; border: none;" />
		<table id="parametres"></table>
	</center>
 </body>
</html>
